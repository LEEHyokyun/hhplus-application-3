가. 분산락 적용 과정
- 분산락의 개념과 적용 환경에 대해 먼저 이해합니다.
- 분산락을 사용하는 이유와 목적을 명확히 이해합니다.
- 분산락을 적용하기 위한 시나리오를 구성 및 이를 바탕으로 구현합니다.


나. 분산락을 적용할 기능을 선정합니다.
- 기존 구현한 pointService의 충전(charge)을 활용하여 분산락을 적용하고자 합니다.
- 분산락은 서비스의 요청을 초점에 맞추어, 요청이 다량 발생하였을때 이에 대한 부하 분산을 의도한 상황에 적용하는 것이 적합할 것입니다.
- 분산락의 목적 등에 의해 상품재고차감 등의 기능에 적용하는 것이 더 적합하다고 생각하고 있습니다.
- 그러나 현재 여건 및 부족한 시간 관계 상 일단 현재 구현한 소스를 기반으로 적용하기 위해 충전 기능에 일단 분산락을 적용할 예정입니다.
- 이후 확장해나가면서 학습범위를 넓힐 계획입니다.

다. 도메인을 설정합니다.
- Redis에 접근하기 위한 기본 환경설정을 config/redis의 RedisConfig를 기반으로 구성하였습니다.
- Redis lock 적용 범위와 트랜잭션 원자성 확보를 모두 고려하였습니다.
	- 트랜잭션의 완전한 원자성을 보장하는 것을 핵심으로 생각하였습니다.
	- @Transactional의 상위 계층에서 redis lock을 적용하도록 하여 lock - transaction - unlock의 과정을 보장할 수 있도록 구성하였습니다.
	- 서비스 AOP를 호출해야 하는 부분을 Service 계층이 아닌, Facade계층(Redis 도메인)으로 이관하여 기존 서비스 로직의 변경을 최소화하였습니다.
- 동시성 제어 및 부하 분산이라는 명확한 목적을 가지는 Redis 특성 상 책임이관이 맞다는 생각이 들어 도메인을 분리하여 접근하였습니다.
	- 기존 서비스 로직 변경을 최소화하고 @Transactional 계층을 변경하는 등의 불필요한 작업을 최소화하기 위한 방안을 도메인 분리로 생각하였습니다.
	- 기존 충전 API와 목적이 다르므로 RedisController 별도 구성하였습니다.
	- Redis 도메인과 charge 도메인의 결합으로 하나의 파사드 서비스를 구성하는 것으로 간주하여 FacadeService로 구성하였습니다.
- Lettuce, Redission 등의 락 제공을 위한 별도의 Provider를 infra layer에 구성하였습니다.

라. 통합테스트 설계
- 각 분리된 도메인의 결합 서비스를 테스트한다는 과정으로 보았을때 통합테스트의 범주로 간주하는 것이 적합하다 생각하였습니다.

마. 분산락 전략을 사용하는 목적
- 여러 DB를 보유하고 있는 환경일 경우 DB Row를 통한 동시성 제어가 불가능하므로 그 범위를 넓히고 동시성 제어가 가능한 외부 저장소가 필요합니다.
- 분산락은 DB Row가 아닌 사용자 요청을 제어하므로 DB의 동시성 제어 책임을 Redis로 이관하여 그 부하를 경감시킬 수 있습니다.
- 분산락은 "사용자의 요청에 대해 동시성 제어가 필요할때 가장 효율적인 방법을 제공하는 도구이다"라는 관점에서 접근해야 할 것입니다.